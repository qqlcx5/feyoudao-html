(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{219:function(s,t,a){s.exports=a.p+"assets/img/entry.fd620404.png"},318:function(s,t,a){"use strict";a.r(t);var n=a(0),e=Object(n.a)({},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"剖析源码vue项目结构-一"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#剖析源码vue项目结构-一","aria-hidden":"true"}},[s._v("#")]),s._v(" 剖析源码Vue项目结构  (一)")]),s._v(" "),n("h2",{attrs:{id:"一-掌握源码目录的结构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-掌握源码目录的结构","aria-hidden":"true"}},[s._v("#")]),s._v(" 一.掌握源码目录的结构")]),s._v(" "),n("h3",{attrs:{id:"_1-介绍vue整个目录结构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-介绍vue整个目录结构","aria-hidden":"true"}},[s._v("#")]),s._v(" 1.介绍Vue整个目录结构")]),s._v(" "),n("ul",[n("li",[s._v(".circleci   持续集成")]),s._v(" "),n("li",[s._v("benchmarks  性能评测")]),s._v(" "),n("li",[s._v("dist        输出目录")]),s._v(" "),n("li",[s._v("examples    案例")]),s._v(" "),n("li",[s._v("flow        flow声明文件")]),s._v(" "),n("li",[s._v("packages    vue中的包")]),s._v(" "),n("li",[s._v("scripts     工程化")]),s._v(" "),n("li",[s._v("src         源码目录")]),s._v(" "),n("li",[s._v("test        测试相关")]),s._v(" "),n("li",[s._v("types       ts声明文件")])]),s._v(" "),n("h3",{attrs:{id:"_2-介绍vue源码的目录结构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-介绍vue源码的目录结构","aria-hidden":"true"}},[s._v("#")]),s._v(" 2.介绍Vue源码的目录结构")]),s._v(" "),n("p",[s._v("为了直观的查看目录我们可以通过"),n("code",[s._v("tree")]),s._v("命令来查看"),n("code",[s._v("src")]),s._v("目录下的文件夹。先大概对源码的结构有一个大体的认识。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("├─compiler       "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编译的相关逻辑")]),s._v("\n│  ├─codegen\n│  ├─directives\n│  └─parser\n├─core           "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vue核心代码")]),s._v("\n│  ├─components  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vue中的内置组件 keep-alive")]),s._v("\n│  ├─global-api  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vue中的全局api")]),s._v("\n│  ├─instance    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vue中的核心逻辑")]),s._v("\n│  ├─observer    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vue中的响应式原理")]),s._v("\n│  ├─util        \n│  └─vdom        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vue中的虚拟dom模块")]),s._v("\n├─platforms      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 平台代码")]),s._v("\n│  ├─web\t     "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# web逻辑 - vue")]),s._v("\n│  │  ├─compiler\n│  │  ├─runtime\n│  │  ├─server\n│  │  └─util\n│  └─weex        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# weex逻辑 - app")]),s._v("\n│      ├─compiler\n│      ├─runtime\n│      └─util\n├─server         "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务端渲染模块")]),s._v("\n├─sfc            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用于编译.vue文件")]),s._v("\n└─shared         "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 共享的方法和常量")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br")])]),n("blockquote",[n("p",[s._v("到这里可能你只能看的懂文件夹的组成，还无法知道代码是如何运行的，so~ 你需要通过"),n("code",[s._v("package.json")]),s._v("来查找代码是如何被打包的!")])]),s._v(" "),n("h2",{attrs:{id:"二-打包流程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二-打包流程","aria-hidden":"true"}},[s._v("#")]),s._v(" 二.打包流程")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"build"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node scripts/build.js"')]),s._v(",  \n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"build:ssr"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"npm run build -- web-runtime-cjs,web-server-renderer"')]),s._v(",\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"build:weex"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"npm run build -- weex"')]),s._v(",\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("blockquote",[n("p",[s._v("核心是使用node执行 "),n("code",[s._v("scripts/build.js")]),s._v(",通过传递参数来实现不同的打包结果，这里的"),n("code",[s._v("--")]),s._v("代表后面的内容是参数。")])]),s._v(" "),n("p",[n("strong",[n("code",[s._v("build.js")])])]),s._v(" "),n("p",[s._v("既然是打包，那我们肯定要找到打包的入口点,所以这里的关键就是查找"),n("strong",[s._v("打包的入口")]),s._v("!")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1.获取不同的打包的配置 ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" builds "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./config'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getAllBuilds")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2.根据执行打包时的参数进行过滤")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("process"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("argv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" filters "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" process"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("argv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("split")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("','")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  builds "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" builds"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("filter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("b")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" filters"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("some")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("f")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("output"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("file"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("indexOf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("f"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("indexOf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("f"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 默认不打包weex相关代码")]),s._v("\n  builds "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" builds"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("filter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("b")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("output"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("file"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("indexOf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'weex'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 3.进行打包")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("build")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("builds"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("p",[n("strong",[s._v("不同的打包配置指的是:")])]),s._v(" "),n("ul",[n("li",[n("p",[n("code",[s._v("web")]),s._v(" / "),n("code",[s._v("weex")]),s._v("    不同的平台")]),s._v(" "),n("blockquote",[n("p",[s._v("这里我们不关注"),n("code",[s._v("weex")]),s._v(","),n("code",[s._v("web")]),s._v("指代的就是我们常用的"),n("code",[s._v("vue")])])])]),s._v(" "),n("li",[n("p",[n("code",[s._v("Runtime only")]),s._v(" / "),n("code",[s._v("Runtime + compiler")]),s._v("    是否带编译模块")]),s._v(" "),n("blockquote",[n("p",[s._v("带有"),n("code",[s._v("compiler")]),s._v("的会将模板转化成"),n("code",[s._v("render")]),s._v("函数")])])]),s._v(" "),n("li",[n("p",[n("code",[s._v("CommonJS")]),s._v("  / "),n("code",[s._v("es")]),s._v(" /  "),n("code",[s._v("umd")]),s._v("  打包出不同模块规范")]),s._v(" "),n("blockquote",[n("p",[n("code",[s._v("umd")]),s._v("模块是整合了"),n("code",[s._v("CommonJS和AMD")]),s._v("两个模块定义规范的方法,当不支持时两种模块时会将其添加到全局变量中")])])])]),s._v(" "),n("p",[n("strong",[s._v("打包入口")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("src/platforms/web/entry-runtime.js\nsrc/platforms/web/entry-runtime-with-compiler.js\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("blockquote",[n("p",[s._v("我们可以通过打包的配置找到我们需要的入口，这两个区别在于是否涵盖"),n("code",[s._v("compiler")]),s._v("逻辑，我们在开发时一般使用的是"),n("code",[s._v("entry-runtime")]),s._v(",可以减小"),n("code",[s._v("vue")]),s._v("的体积，但是同样在开发时也不能再使用"),n("code",[s._v("template")]),s._v(","),n("code",[s._v(".vue")]),s._v("文件中的"),n("code",[s._v("template")]),s._v("是通过"),n("code",[s._v("vue-loader")]),s._v("来进行编译的，和我们所说的"),n("code",[s._v("compiler")]),s._v("无关哈。")])]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Vue")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\ttemplate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("<div></div>")]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("blockquote",[n("p",[s._v("这样的template必须要使用带compiler的入口才能进行模板的解析")])]),s._v(" "),n("h2",{attrs:{id:"三-入口分析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三-入口分析","aria-hidden":"true"}},[s._v("#")]),s._v(" 三.入口分析")]),s._v(" "),n("p",[s._v("这里为了剖析"),n("code",[s._v("vue")]),s._v("完整的代码,我们就来分析带有"),n("code",[s._v("compiler")]),s._v("的文件。")]),s._v(" "),n("blockquote",[n("p",[s._v("我们观察这两个入口的文件不难发现他们都引入了"),n("code",[s._v("runtime/index.js")])])]),s._v(" "),n("p",[n("strong",[n("code",[s._v("entry-runtime-with-compiler.js")])])]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Vue "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./runtime/index'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//    1.引入运行时代码")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" mount "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Vue")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("prototype"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("$mount"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//  2.获取runtime中的$mount方法")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Vue")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("prototype"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("$mount")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("el"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("hydrating")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 3. 重写$mount方法")]),s._v("\n  el "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" el "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("query")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("el"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" options "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("$options\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("render"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 4.没有render方法就进行编译操作")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" template "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("template\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("template"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 5.将模板编译成函数")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" render"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" staticRenderFns "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("compileToFunctions")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("template"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            outputSourceRange"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" process"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("env"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NODE_ENV")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'production'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            shouldDecodeNewlines"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            shouldDecodeNewlinesForHref"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            delimiters"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("delimiters"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            comments"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("comments\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("render "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" render "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 6.将render函数放到options中")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// todo...")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("call")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" el"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" hydrating"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 7.进行挂载操作")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" Vue\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br")])]),n("blockquote",[n("p",[s._v("带有"),n("code",[s._v("compiler")]),s._v("的文件仅仅是对"),n("code",[s._v("$mount")]),s._v("方法进行了重写,增添了将"),n("code",[s._v("template")]),s._v("变成"),n("code",[s._v("render")]),s._v("函数的功能")])]),s._v(" "),n("h2",{attrs:{id:"四-vue的构造函数"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#四-vue的构造函数","aria-hidden":"true"}},[s._v("#")]),s._v(" 四.Vue的构造函数")]),s._v(" "),n("p",[n("img",{attrs:{src:a(219),alt:""}})]),s._v(" "),n("ul",[n("li",[n("code",[s._v("instance/index.js")]),s._v("  真正的Vue的构造函数,并在Vue的原型上扩展方法")]),s._v(" "),n("li",[n("code",[s._v("core/index.js")]),s._v("          增加全局"),n("code",[s._v("API")]),s._v("方法")]),s._v(" "),n("li",[n("code",[s._v("runtime/index.js")]),s._v("    扩展"),n("code",[s._v("$mount")]),s._v("方法及平台对应的代码")])]),s._v(" "),n("blockquote",[n("p",[s._v("到此为止我们就将文件关联起来了。下一步我们就开始来分析细节吧!")])])])},[],!1,null,null,null);t.default=e.exports}}]);